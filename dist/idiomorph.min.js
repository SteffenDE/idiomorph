var Idiomorph=function(){"use strict";let o=new Set;let l={morphStyle:"outerHTML",callbacks:{beforeNodeAdded:t,afterNodeAdded:t,beforeNodeMorphed:t,afterNodeMorphed:t,beforeNodeRemoved:t,afterNodeRemoved:t,beforeAttributeUpdated:t,getNodeKey:e=>e.id},head:{style:"merge",shouldPreserve:function(e){return e.getAttribute("im-preserve")==="true"},shouldReAppend:function(e){return e.getAttribute("im-re-append")==="true"},shouldRemove:t,afterHeadMorphed:t}};function e(e,t,l={}){if(e instanceof Document){e=e.documentElement}if(typeof t==="string"){t=A(t)}let n=N(t);let r=p(e,n,l);return a(e,n,r)}function a(r,i,o){if(o.head.block){let t=r.querySelector("head");let l=i.querySelector("head");if(t&&l){let e=s(l,t,o);Promise.all(e).then(function(){a(r,i,Object.assign(o,{head:{block:false,ignore:true}}))});return}}if(o.morphStyle==="innerHTML"){n(i,r,o);return r.children}else if(o.morphStyle==="outerHTML"||o.morphStyle==null){let e=M(i,r,o);let t=e?.previousSibling;let l=e?.nextSibling;let n=d(r,e,o);if(e){return S(t,n,l)}else{return[]}}else{throw"Do not understand how to morph style "+o.morphStyle}}function u(e,t){return t.ignoreActiveValue&&e===document.activeElement&&e!==document.body}function d(e,t,l){if(l.ignoreActive&&e===document.activeElement){}else if(t==null){if(l.callbacks.beforeNodeRemoved(e)===false)return e;e.remove();l.callbacks.afterNodeRemoved(e);return null}else if(!g(e,t)){if(l.callbacks.beforeNodeRemoved(e)===false)return e;if(l.callbacks.beforeNodeAdded(t)===false)return e;e.parentElement.replaceChild(t,e);l.callbacks.afterNodeAdded(t);l.callbacks.afterNodeRemoved(e);return t}else{if(l.callbacks.beforeNodeMorphed(e,t)===false)return e;if(e instanceof HTMLHeadElement&&l.head.ignore){}else if(e instanceof HTMLHeadElement&&l.head.style!=="morph"){s(t,e,l)}else{r(t,e,l);if(!u(e,l)){n(t,e,l)}}l.callbacks.afterNodeMorphed(e,t);return e}}function n(l,n,r){let i=l.firstChild;let o=n.firstChild;let a;while(i){a=i;i=a.nextSibling;if(o==null){if(r.callbacks.beforeNodeAdded(a)===false)return;n.appendChild(a);r.callbacks.afterNodeAdded(a);H(r,a);continue}if(b(a,o,r)){d(o,a,r);o=o.nextSibling;H(r,a);continue}let e=y(l,n,a,o,r);if(e){o=v(o,e,r);d(e,a,r);H(r,a);continue}let t=k(l,n,a,o,r);if(t){o=v(o,t,r);d(t,a,r);H(r,a);continue}if(r.callbacks.beforeNodeAdded(a)===false)return;n.insertBefore(a,o);r.callbacks.afterNodeAdded(a);H(r,a)}while(o!==null){let e=o;o=o.nextSibling;T(e,r)}}function f(e,t,l,n){if(e==="value"&&n.ignoreActiveValue&&t===document.activeElement){return true}return n.callbacks.beforeAttributeUpdated(e,t,l)===false}function r(t,l,n){let e=t.nodeType;if(e===1){const r=t.attributes;const i=l.attributes;for(const o of r){if(f(o.name,l,"update",n)){continue}if(l.getAttribute(o.name)!==o.value){l.setAttribute(o.name,o.value)}}for(let e=i.length-1;0<=e;e--){const a=i[e];if(f(a.name,l,"remove",n)){continue}if(!t.hasAttribute(a.name)){l.removeAttribute(a.name)}}}if(e===8||e===3){if(l.nodeValue!==t.nodeValue){l.nodeValue=t.nodeValue}}if(!u(l,n)){c(t,l,n)}}function i(t,l,n,r){if(t[n]!==l[n]){let e=f(n,l,"update",r);if(!e){l[n]=t[n]}if(t[n]){if(!e){l.setAttribute(n,t[n])}}else{if(!f(n,l,"remove",r)){l.removeAttribute(n)}}}}function c(l,n,r){if(l instanceof HTMLInputElement&&n instanceof HTMLInputElement&&l.type!=="file"){let e=l.value;let t=n.value;i(l,n,"checked",r);i(l,n,"disabled",r);if(!l.hasAttribute("value")){if(!f("value",n,"remove",r)){n.value="";n.removeAttribute("value")}}else if(e!==t){if(!f("value",n,"update",r)){n.setAttribute("value",e);n.value=e}}}else if(l instanceof HTMLOptionElement){i(l,n,"selected",r)}else if(l instanceof HTMLTextAreaElement&&n instanceof HTMLTextAreaElement){let e=l.value;let t=n.value;if(f("value",n,"update",r)){return}if(e!==t){n.value=e}if(n.firstChild&&n.firstChild.nodeValue!==e){n.firstChild.nodeValue=e}}}function s(e,t,n){let r=[];let i=[];let o=[];let a=[];let u=n.head.style;let d=new Map;for(const l of e.children){d.set(l.outerHTML,l)}for(const c of t.children){let e=d.has(c.outerHTML);let t=n.head.shouldReAppend(c);let l=n.head.shouldPreserve(c);if(e||l){if(t){i.push(c)}else{d.delete(c.outerHTML);o.push(c)}}else{if(u==="append"){if(t){i.push(c);a.push(c)}}else{if(n.head.shouldRemove(c)!==false){i.push(c)}}}}a.push(...d.values());m("to append: ",a);let f=[];for(const s of a){m("adding: ",s);let l=document.createRange().createContextualFragment(s.outerHTML).firstChild;m(l);if(n.callbacks.beforeNodeAdded(l)!==false){if(l.href||l.src){let t=null;let e=new Promise(function(e){t=e});l.addEventListener("load",function(){t()});f.push(e)}t.appendChild(l);n.callbacks.afterNodeAdded(l);r.push(l)}}for(const h of i){if(n.callbacks.beforeNodeRemoved(h)!==false){t.removeChild(h);n.callbacks.afterNodeRemoved(h)}}n.head.afterHeadMorphed(t,{added:r,kept:o,removed:i});return f}function m(){}function t(){}function h(e){let t={};Object.assign(t,l);Object.assign(t,e);t.callbacks={};Object.assign(t.callbacks,l.callbacks);Object.assign(t.callbacks,e.callbacks);t.head={};Object.assign(t.head,l.head);Object.assign(t.head,e.head);return t}function p(e,t,l){l=h(l);return{target:e,newContent:t,config:l,morphStyle:l.morphStyle,ignoreActive:l.ignoreActive,ignoreActiveValue:l.ignoreActiveValue,idMap:C(e,t,l.callbacks.getNodeKey),deadIds:new Set,callbacks:l.callbacks,head:l.head}}function b(e,t,l){if(e==null||t==null){return false}if(e.nodeType===t.nodeType&&e.tagName===t.tagName){if(l.callbacks.getNodeKey(e)!==""&&l.callbacks.getNodeKey(e)===l.callbacks.getNodeKey(t)){return true}else{return L(l,e,t)>0}}return false}function g(e,t){if(e==null||t==null){return false}return e.nodeType===t.nodeType&&e.tagName===t.tagName}function v(t,e,l){while(t!==e){let e=t;t=t.nextSibling;T(e,l)}H(l,e);return e.nextSibling}function y(l,e,n,r,i){let o=L(i,n,e);let t=null;if(o>0){let e=r;let t=0;while(e!=null){if(b(n,e,i)){return e}t+=L(i,e,l);if(t>o){return null}e=e.nextSibling}}return t}function k(e,t,l,n,r){let i=n;let o=l.nextSibling;let a=0;while(i!=null){if(L(r,i,e)>0){return null}if(g(l,i)){return i}if(g(o,i)){a++;o=o.nextSibling;if(a>=2){return null}}i=i.nextSibling}return i}function A(l){let n=new DOMParser;let e=l.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"");if(e.match(/<\/html>/)||e.match(/<\/head>/)||e.match(/<\/body>/)){let t=n.parseFromString(l,"text/html");if(e.match(/<\/html>/)){t.generatedByIdiomorph=true;return t}else{let e=t.firstChild;if(e){e.generatedByIdiomorph=true;return e}else{return null}}}else{let e=n.parseFromString("<body><template>"+l+"</template></body>","text/html");let t=e.body.querySelector("template").content;t.generatedByIdiomorph=true;return t}}function N(e){if(e==null){const t=document.createElement("div");return t}else if(e.generatedByIdiomorph){return e}else if(e instanceof Node){const t=document.createElement("div");t.append(e);return t}else{const t=document.createElement("div");for(const l of[...e]){t.append(l)}return t}}function S(e,t,l){let n=[];let r=[];while(e!=null){n.push(e);e=e.previousSibling}while(n.length>0){let e=n.pop();r.push(e);t.parentElement.insertBefore(e,t)}r.push(t);while(l!=null){n.push(l);r.push(l);l=l.nextSibling}while(n.length>0){t.parentElement.insertBefore(n.pop(),t.nextSibling)}return r}function M(e,t,l){let n;n=e.firstChild;let r=n;let i=0;while(n){let e=w(n,t,l);if(e>i){r=n;i=e}n=n.nextSibling}return r}function w(e,t,l){if(g(e,t)){return.5+L(l,e,t)}return 0}function T(e,t){H(t,e);if(t.callbacks.beforeNodeRemoved(e)===false)return;e.remove();t.callbacks.afterNodeRemoved(e)}function E(e,t){return!e.deadIds.has(t)}function x(e,t,l){let n=e.idMap.get(l)||o;return n.has(t)}function H(e,t){let l=e.idMap.get(t)||o;for(const n of l){e.deadIds.add(n)}}function L(e,t,l){let n=e.idMap.get(t)||o;let r=0;for(const i of n){if(E(e,i)&&x(e,i,l)){++r}}return r}function R(e,l,n){let r=e.parentElement;let t=e.querySelectorAll("[id]");for(const i of t){let t=i;while(t!==r&&t!=null){let e=l.get(t);if(e==null){e=new Set;l.set(t,e)}e.add(n(i));t=t.parentElement}}}function C(e,t,l){let n=new Map;R(e,n,l);R(t,n,l);return n}return{morph:e,defaults:l}}();